<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>라팡</title>
  <style>
    :root{
      --bg:#0b0c10;
      --panel:#111319;
      --panel2:#0f1116;
      --line:rgba(255,255,255,.08);
      --text:#f5f7ff;
      --muted:rgba(245,247,255,.65);
      --accent:#ff9f00;
      --good:#29d17e;
      --bad:#ff3b30;
      --btn:#f3f4f6;
      --btnText:#111;
      --shadow:0 12px 40px rgba(0,0,0,.35);
      --r:18px;
    }

    *{box-sizing:border-box;}
    html,body{height:100%; margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Apple SD Gothic Neo,sans-serif;}
    button,input{font-family:inherit;}
    .topbar{
      position:sticky; top:0; z-index:10;
      background:var(--accent);
      padding:14px 16px;
      text-align:center;
      font-weight:900;
      letter-spacing:.5px;
      color:#111;
      box-shadow:0 6px 18px rgba(0,0,0,.25);
    }

    .app{
      display:flex;
      gap:12px;
      padding:12px;
      height:calc(100vh - 52px);
    }

    /* LEFT */
    .left{
      flex: 1 1 auto;
      min-width: 0;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .tab{
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      color:var(--text);
      padding:10px 14px;
      border-radius:14px;
      font-weight:800;
      font-size:16px;
      cursor:pointer;
      user-select:none;
      min-width:84px;
      text-align:center;
    }
    .tab.active{
      border-color:rgba(255,159,0,.55);
      box-shadow:0 0 0 3px rgba(255,159,0,.18) inset;
    }

    .search{
      flex:1 1 280px;
      min-width:260px;
      border-radius:14px;
      border:1px solid var(--line);
      padding:12px 14px;
      background:rgba(255,255,255,.04);
      color:var(--text);
      outline:none;
      font-size:18px;
      font-weight:800;
    }
    .search::placeholder{color:rgba(245,247,255,.45); font-weight:700;}

    .items{
      flex:1 1 auto;
      min-height:0;
      border-radius:var(--r);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      padding:10px;
      overflow:auto;
      box-shadow:var(--shadow);
    }

    /* 타일형 4~5열 */
    .grid{
      display:grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap:10px;
    }
    @media (max-width: 1200px){
      .grid{grid-template-columns: repeat(4, minmax(0, 1fr));}
    }
    @media (max-width: 900px){
      .app{flex-direction:column; height:auto;}
      .right{width:auto;}
      .grid{grid-template-columns: repeat(4, minmax(0, 1fr));}
    }
    @media (max-width: 560px){
      .grid{grid-template-columns: repeat(3, minmax(0, 1fr));}
      .search{min-width: 180px;}
    }

    .tile{
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-radius:16px;
      padding:14px 14px 12px;
      cursor:pointer;
      user-select:none;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      min-height:92px;
      position:relative;
      overflow:hidden;
    }
    .tile:active{transform:scale(.99);}
    .tile .name{
      font-size:22px;          /* 품목명 크게 */
      font-weight:900;
      letter-spacing:-.2px;
      line-height:1.1;
      text-align:left;
      word-break:keep-all;
    }
    .tile .meta{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:8px;
      margin-top:10px;
    }
    .tile .unit{
      color:var(--muted);
      font-weight:800;
      font-size:14px;          /* 단위 작게 */
    }
    .tile .price{
      font-size:16px;          /* 가격 작게 */
      font-weight:900;
      color:rgba(245,247,255,.75);
      letter-spacing:.2px;
    }

    /* RIGHT */
    .right{
      width: 420px;
      flex: 0 0 420px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-width: 320px;
    }

    .panel{
      border-radius:var(--r);
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--line);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    .summary{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
    }
    .sum-left{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }
    .sum-label{
      font-weight:900;
      font-size:16px;
      color:rgba(245,247,255,.78);
    }
    .sum-total{
      font-weight:1000;
      font-size:34px;
      letter-spacing:.3px;
      line-height:1;
      white-space:nowrap;
    }
    .sum-count{
      font-weight:900;
      font-size:18px;
      color:rgba(245,247,255,.8);
      white-space:nowrap;
    }

    .cartList{
      height: 52vh;            /* 목록이 최소 7개 이상 보이게 */
      min-height: 280px;
      overflow:auto;
      padding:10px;
    }

    .empty{
      color:rgba(245,247,255,.55);
      font-weight:900;
      padding:10px;
    }

    .cartItem{
      display:grid;
      grid-template-columns: 1fr auto auto;
      gap:10px;
      align-items:center;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      margin-bottom:10px;
    }
    .ci-name{
      font-size:20px;
      font-weight:950;
      line-height:1.1;
    }
    .ci-sub{
      margin-top:6px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      color:rgba(245,247,255,.72);
      font-weight:850;
      font-size:14px;
    }

    .qtyGroup{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .qtyBtn{
      width:44px; height:44px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      font-weight:1000;
      font-size:22px;
      cursor:pointer;
      user-select:none;
    }
    .qtyBadge{
      min-width:54px;
      height:44px;
      border-radius:14px;
      border:1px solid rgba(255,159,0,.35);
      background:rgba(255,159,0,.14);
      color:var(--text);
      font-weight:1000;
      font-size:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0 10px;
      white-space:nowrap;
    }

    .delBtn{
      width:52px; height:52px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);  /* 빨강 과하지 않게 */
      cursor:pointer;
      display:grid;
      place-items:center;
    }
    .delBtn svg{opacity:.9}
    .delBtn:active{transform:scale(.99);}

    .pay{
      padding:12px;
      border-top:1px solid var(--line);
      background:rgba(0,0,0,.22);
    }

    /* 총금액/받은돈/거스름 한줄 크게 */
    .moneyRow{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
      align-items:center;
      margin-bottom:12px;
    }
    .moneyBox{
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(255,255,255,.04);
      padding:10px 12px;
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }
    .moneyBox .lbl{
      font-weight:950;
      font-size:14px;
      color:rgba(245,247,255,.7);
    }
    .moneyBox .val{
      font-weight:1100;
      font-size:26px;
      line-height:1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .moneyBox.total .val{color:#fff;}
    .moneyBox.paid .val{color:#7dd3fc;}
    .moneyBox.change .val{color:#86efac;}

    .moneyBtns{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
      margin-bottom:12px;
    }
    .mBtn{
      background:var(--btn);
      color:var(--btnText);
      border:none;
      border-radius:14px;
      padding:14px 0;
      font-weight:1000;
      font-size:20px;
      cursor:pointer;
      user-select:none;
      box-shadow:0 6px 14px rgba(0,0,0,.18);
    }
    .mBtn:active{transform:scale(.99);}

    /* 10만 삭제 → 초기화가 그 자리 */
    .resetBtn{
      background:var(--bad);
      color:#fff;
      border:none;
      border-radius:14px;
      padding:14px 0;
      font-weight:1100;
      font-size:18px;
      cursor:pointer;
      user-select:none;
      box-shadow:0 10px 22px rgba(255,59,48,.25);
    }
    .resetBtn:active{transform:scale(.99);}

    /* 결제완료 크기 고정 */
    .complete{
      width:100%;
      border:none;
      border-radius:18px;
      padding:18px 0;
      font-weight:1100;
      font-size:28px;
      background:var(--good);
      color:#063a22;
      cursor:pointer;
      user-select:none;
      box-shadow:0 14px 30px rgba(41,209,126,.25);
    }
    .complete:active{transform:scale(.99);}

    .smallNote{
      margin-top:8px;
      color:rgba(245,247,255,.45);
      font-weight:800;
      font-size:12px;
    }
  </style>
</head>

<body>
  <div class="topbar">라팡</div>

  <div class="app">
    <!-- LEFT -->
    <section class="left">
      <div class="controls">
        <div class="tabs" id="tabs"></div>
        <input id="search" class="search" placeholder="검색 (예: ㄱ, ㄱㄱ, 고구마, 감자)" autocomplete="off" />
      </div>

      <div class="items">
        <div class="grid" id="grid"></div>
      </div>
    </section>

    <!-- RIGHT -->
    <aside class="right">
      <div class="panel">
        <div class="summary">
          <div class="sum-left">
            <div class="sum-label">총합계 / 총갯수</div>
            <div class="sum-total" id="sumTotal">₩0</div>
          </div>
          <div class="sum-count" id="sumCount">총 0개</div>
        </div>

        <div class="cartList" id="cartList"></div>

        <div class="pay">
          <div class="moneyRow">
            <div class="moneyBox total">
              <div class="lbl">총금액</div>
              <div class="val" id="payTotal">₩0</div>
            </div>
            <div class="moneyBox paid">
              <div class="lbl">받은돈</div>
              <div class="val" id="paid">₩0</div>
            </div>
            <div class="moneyBox change">
              <div class="lbl">거스름</div>
              <div class="val" id="change">₩0</div>
            </div>
          </div>

          <div class="moneyBtns">
            <button class="mBtn" onclick="addMoney(1000)">1천</button>
            <button class="mBtn" onclick="addMoney(5000)">5천</button>
            <button class="mBtn" onclick="addMoney(10000)">1만</button>

            <button class="mBtn" onclick="addMoney(30000)">3만</button>
            <button class="mBtn" onclick="addMoney(50000)">5만</button>
            <button class="resetBtn" onclick="resetPaidOnly()">초기화</button>
          </div>

          <button class="complete" onclick="complete()">결제 완료</button>
          <div class="smallNote">※ 초기화는 “받은돈/거스름”만 리셋됩니다. (품목은 유지)</div>
        </div>
      </div>
    </aside>
  </div>

  <script src="items.js"></script>

  <script>
    const money = (n) => "₩" + (n||0).toLocaleString("ko-KR");

    // 초성
    const CHO = ["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    function getChosung(str){
      let out = "";
      for (const ch of (str||"")){
        const code = ch.charCodeAt(0);
        if (code >= 0xAC00 && code <= 0xD7A3){
          const idx = Math.floor((code - 0xAC00) / 588);
          out += CHO[idx] || "";
        } else if ("ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌㅍㅎ".includes(ch)){
          out += ch;
        }
      }
      return out;
    }
    function normalize(s){ return (s||"").toString().trim().toLowerCase().replace(/\s+/g,""); }
    function isChosungQuery(q){
      const t = (q||"").replace(/\s+/g,"");
      return t.length>0 && /^[ㄱ-ㅎ]+$/.test(t);
    }

    const ALL = (window.ITEMS || []).map((it, idx) => ({
      ...it,
      id: it.id ?? idx,
      nrm: normalize(it.name),
      cho: getChosung(it.name),
    }));

    const CATS = ["전체", ...Array.from(new Set(ALL.map(x=>x.cat)))];
    let activeCat = "과일"; // 기본 탭
    let paid = 0;

    // cart: Map(id -> {item, qty})
    const cart = new Map();

    const $tabs = document.getElementById("tabs");
    const $grid = document.getElementById("grid");
    const $search = document.getElementById("search");
    const $cartList = document.getElementById("cartList");
    const $sumTotal = document.getElementById("sumTotal");
    const $sumCount = document.getElementById("sumCount");
    const $paid = document.getElementById("paid");
    const $change = document.getElementById("change");
    const $payTotal = document.getElementById("payTotal");

    function renderTabs(){
      $tabs.innerHTML = "";
      for (const c of CATS){
        const b = document.createElement("button");
        b.className = "tab" + (c===activeCat ? " active":"");
        b.textContent = c;
        b.onclick = () => { activeCat = c; renderTabs(); renderItems(); };
        $tabs.appendChild(b);
      }
    }

    function filterItems(){
      const q = $search.value.trim();
      const hasQ = q.length>0;

      // 검색이 있으면 카테고리 무시(요청사항)
      let base = ALL;
      if (!hasQ){
        base = (activeCat==="전체") ? ALL : ALL.filter(x=>x.cat===activeCat);
      }

      if (!hasQ) return base;

      const nq = normalize(q);
      const cq = q.replace(/\s+/g,"");

      if (isChosungQuery(cq)){
        // ㄱ, ㄱㄱ 등: 초성 prefix
        return base.filter(x => x.cho.startsWith(cq));
      }

      // 일반: 부분 + 초성 포함 보조
      return base.filter(x => x.nrm.includes(nq) || x.cho.includes(cq));
    }

    function renderItems(){
      const list = filterItems();
      $grid.innerHTML = "";
      for (const it of list){
        const d = document.createElement("div");
        d.className = "tile";
        d.onclick = () => addToCart(it.id);
        d.innerHTML = `
          <div class="name">${escapeHtml(it.name)}</div>
          <div class="meta">
            <div class="unit">${escapeHtml(it.unit || "")}</div>
            <div class="price">${money(it.price)}</div>
          </div>
        `;
        $grid.appendChild(d);
      }
    }

    function cartTotals(){
      let total = 0;
      let count = 0;
      for (const {item, qty} of cart.values()){
        total += item.price * qty;
        count += qty;
      }
      return {total, count};
    }

    function renderCart(){
      const {total, count} = cartTotals();

      $sumTotal.textContent = money(total);
      $sumCount.textContent = `총 ${count}개`;
      $payTotal.textContent = money(total);

      $paid.textContent = money(paid);
      const change = Math.max(paid - total, 0);
      $change.textContent = money(change);

      if (cart.size === 0){
        $cartList.innerHTML = `<div class="empty">(비어있음)</div>`;
        return;
      }

      const arr = Array.from(cart.values());
      $cartList.innerHTML = "";

      for (const row of arr){
        const {item, qty} = row;
        const lineTotal = item.price * qty;

        const wrap = document.createElement("div");
        wrap.className = "cartItem";

        wrap.innerHTML = `
          <div>
            <div class="ci-name">${escapeHtml(item.name)}</div>
            <div class="ci-sub">
              <span>단가 ${money(item.price)}</span>
              <span>합계 ${money(lineTotal)}</span>
            </div>
          </div>

          <div class="qtyGroup">
            <button class="qtyBtn" title="빼기">–</button>
            <div class="qtyBadge">x${qty}</div>
            <button class="qtyBtn" title="더하기">+</button>
          </div>

          <button class="delBtn" title="삭제" aria-label="삭제">
            ${trashSvg()}
          </button>
        `;

        const btns = wrap.querySelectorAll(".qtyBtn");
        btns[0].onclick = () => decQty(item.id);
        btns[1].onclick = () => incQty(item.id);
        wrap.querySelector(".delBtn").onclick = () => removeItem(item.id);

        $cartList.appendChild(wrap);
      }
    }

    function addToCart(id){
      const it = ALL.find(x=>x.id===id);
      if (!it) return;
      if (cart.has(id)) cart.get(id).qty += 1;
      else cart.set(id, {item: it, qty: 1});
      renderCart();
    }
    function incQty(id){
      if (!cart.has(id)) return;
      cart.get(id).qty += 1;
      renderCart();
    }
    function decQty(id){
      if (!cart.has(id)) return;
      const row = cart.get(id);
      row.qty -= 1;
      if (row.qty <= 0) cart.delete(id);
      renderCart();
    }
    function removeItem(id){
      cart.delete(id);
      renderCart();
    }

    function addMoney(amount){
      paid += amount;
      renderCart();
    }

    // 초기화: 받은돈/거스름만
    function resetPaidOnly(){
      paid = 0;
      renderCart();
    }

    // 결제완료: 알림 + 받은돈만 초기화 (품목 유지)
    function complete(){
      alert("결제 완료!");
      paid = 0;
      renderCart();
    }

    function escapeHtml(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function trashSvg(){
      return `
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 3h6l1 2h4v2H4V5h4l1-2Z" fill="rgba(255,255,255,.85)"/>
          <path d="M6 9h12l-1 12a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 9Z" fill="rgba(255,255,255,.85)"/>
          <path d="M10 12v8M14 12v8" stroke="rgba(17,17,17,.85)" stroke-width="2" stroke-linecap="round"/>
        </svg>
      `;
    }

    $search.addEventListener("input", () => renderItems());

    renderTabs();
    renderItems();
    renderCart();
  </script>
</body>
</html>
