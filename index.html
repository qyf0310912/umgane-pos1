<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ì—„ê°€ë„¤ POS</title>

<style>
:root{
  --bg:#10131a;
  --panel:#151a24;
  --panel2:#121724;
  --card:#222a3a;
  --card2:#263048;
  --line:rgba(255,255,255,.12);
  --text:#f7f9ff;
  --muted:rgba(247,249,255,.65);
  --accent:#ff9f00;
  --danger:#ff4d4f;
  --good:#2fd27e;
  --btn:#f4f5f7;
  --btnText:#111;
  --shadow:0 14px 44px rgba(0,0,0,.35);
  --r:18px;
}

*{box-sizing:border-box}
html,body{height:100%; margin:0; background:var(--bg); color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",system-ui,Segoe UI,Roboto,sans-serif;
}
button,input{font:inherit}

.app{
  height:100%;
  display:grid;
  grid-template-columns: 3fr 1fr;
  gap:14px;
  padding:14px;
}

/* LEFT */
.left{
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
  border:1px solid var(--line);
  border-radius:22px;
  box-shadow:var(--shadow);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

.topbar{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-bottom:1px solid var(--line);
  background:rgba(255,255,255,.02);
}
.tabs{ display:flex; gap:8px; flex-wrap:wrap; }
.tab{
  padding:8px 14px;
  border-radius:999px;
  border:1px solid var(--line);
  background:#1d2332;
  color:var(--text);
  font-weight:900;
  cursor:pointer;
}
.tab.active{
  background:rgba(255,159,0,.18);
  border-color:rgba(255,159,0,.45);
}

/* search */
.searchwrap{
  padding:10px 12px;
  border-bottom:1px solid var(--line);
  background:rgba(255,255,255,.015);
}
.searchrow{
  display:flex;
  gap:10px;
  align-items:center;
}
.search{
  flex:1;
  display:flex;
  align-items:center;
  gap:10px;
  background:rgba(255,255,255,.04);
  border:1px solid var(--line);
  border-radius:14px;
  padding:10px 12px;
}
.search .icon{opacity:.7}
.search input{
  width:100%;
  border:none;
  outline:none;
  background:transparent;
  color:var(--text);
  font-weight:800;
  font-size:15px;
}
.sort{
  display:flex;
  align-items:center;
  gap:8px;
  padding:10px 12px;
  border:1px solid var(--line);
  border-radius:14px;
  background:rgba(255,255,255,.03);
  font-weight:900;
  cursor:pointer;
  white-space:nowrap;
}
.sort small{opacity:.7; font-weight:800}

/* chosung keys */
.cho{
  margin-top:10px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.cho button{
  padding:8px 10px;
  border-radius:12px;
  border:1px solid var(--line);
  background:rgba(255,255,255,.03);
  color:var(--text);
  font-weight:1000;
  cursor:pointer;
  min-width:40px;
}
.cho button:active{transform:scale(.98)}
.cho button.clear{
  background:rgba(255,77,79,.18);
  border-color:rgba(255,77,79,.35);
}

/* products grid */
.products{
  padding:12px;
  overflow:auto;
  display:grid;
  grid-template-columns:repeat(4, minmax(0,1fr));
  gap:12px;
}
@media (min-width: 1500px){
  .products{ grid-template-columns:repeat(5, minmax(0,1fr)); }
}

.card{
  background:linear-gradient(180deg, var(--card2), var(--card));
  border:1px solid rgba(255,255,255,.14);
  border-radius:18px;
  padding:14px;
  cursor:pointer;
  user-select:none;
  position:relative;
  min-height:86px;
  transition:.08s;
  z-index:1;
}
.card:active{transform:scale(.985)}
.card.flash{ box-shadow:0 0 0 3px rgba(255,159,0,.45); }

.name{font-size:18px; font-weight:1100; letter-spacing:-.2px}
.price{margin-top:6px; font-size:14px; opacity:.9; font-weight:900}
.meta{
  position:absolute;
  right:10px;
  top:10px;
  display:flex;
  gap:8px;
  align-items:center;
  opacity:.85;
}
.badge{
  font-size:12px;
  padding:4px 8px;
  border-radius:999px;
  border:1px solid var(--line);
  background:rgba(255,255,255,.03);
  font-weight:1000;
}
.pin{
  width:28px; height:28px;
  display:grid; place-items:center;
  border-radius:10px;
  border:1px solid var(--line);
  background:rgba(0,0,0,.15);
}
.pin.on{
  border-color:rgba(255,159,0,.55);
  background:rgba(255,159,0,.18);
}

/* âœ… í´ë¦­ ê°€ë¡œì±„ê¸° ë°©ì§€: meta ì˜ì—­ì´ í´ë¦­ì„ ë¨¹ì§€ ëª»í•˜ê²Œ */
.meta, .meta * { pointer-events:none; }

.hint{
  padding:8px 12px 12px;
  color:var(--muted);
  font-size:12px;
  font-weight:800;
  border-top:1px solid var(--line);
  background:rgba(255,255,255,.01);
}

/* RIGHT */
.right{
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
  border:1px solid var(--line);
  border-radius:22px;
  box-shadow:var(--shadow);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

/* cart */
.cart{
  padding:12px;
  overflow:auto;
  flex:1;
}
.carthead{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
  font-weight:1100;
}
.carthead .muted{opacity:.7; font-weight:900}
.item{
  background:rgba(255,255,255,.03);
  border:1px solid var(--line);
  border-radius:14px;
  padding:10px;
  display:grid;
  grid-template-columns: 1fr auto;
  gap:10px;
  margin-bottom:8px;
}
.item .title{ font-weight:1100; font-size:14px; }
.item .sub{ margin-top:4px; font-size:12px; opacity:.8; font-weight:900; }
.controls{ display:flex; gap:8px; align-items:center; }
.ctrl{
  width:38px; height:36px;
  border-radius:12px;
  border:1px solid var(--line);
  background:rgba(255,255,255,.03);
  color:var(--text);
  font-weight:1200;
  cursor:pointer;
}
.ctrl.del{ background:rgba(255,77,79,.18); border-color:rgba(255,77,79,.35); }
.ctrl:active{transform:scale(.98)}
.count{ width:26px; text-align:center; font-weight:1200; }

/* summary */
.summary{
  padding:12px;
  border-top:1px solid var(--line);
  background:rgba(255,255,255,.015);
}
.row{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  gap:12px;
  margin-bottom:8px;
}
.label{font-size:12px; opacity:.7; font-weight:1000}
.val{font-size:20px; font-weight:1200}
.smallval{font-size:14px; font-weight:1100; opacity:.95}

/* âœ… ë°›ì€ëˆ(ì™¼ìª½) / ê±°ìŠ¤ë¦„ëˆ(ì˜¤ë¥¸ìª½) í•œ ì¤„ */
.payline{
  display:flex;
  align-items:flex-end;
  gap:12px;
  font-weight:1200;
  margin-top:10px;
}
.payline .block{ flex:1; }
.payline .divider{
  width:2px;
  height:26px;
  background:rgba(255,255,255,.14);
  border-radius:99px;
  align-self:center;
}
.payline .leftAlign{ text-align:left; }
.payline .rightAlign{ text-align:right; } /* âœ… ê±°ìŠ¤ë¦„ëˆ ì˜¤ë¥¸ìª½ ì •ë ¬ */

/* money buttons: 3ê°œì”© 2ì¤„ */
.money{
  padding:12px;
  border-top:1px solid var(--line);
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  gap:10px;
  background:rgba(255,255,255,.01);
}
.money button{
  padding:12px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:1200;
  cursor:pointer;
  background:var(--btn);
  color:var(--btnText);
}
.money button:active{transform:scale(.99)}
.money button.reset{
  background:rgba(255,77,79,.22);
  color:#ffe2e2;
}

/* pay */
.pay{
  margin:12px;
  margin-top:0;
  border:none;
  border-radius:16px;
  padding:16px;
  background:var(--accent);
  font-size:18px;
  font-weight:1300;
  cursor:pointer;
}
.pay.locked{opacity:.55; pointer-events:none}

/* modal */
.overlay{
  position:fixed; inset:0;
  background:rgba(0,0,0,.65);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.overlay.show{display:flex}
.modal{
  width:min(520px, 92vw);
  background:#161c28;
  border:1px solid rgba(255,255,255,.14);
  border-radius:20px;
  padding:18px;
  box-shadow:var(--shadow);
}
.modal h3{margin:0 0 8px; font-size:18px; font-weight:1200}
.modal p{margin:0; opacity:.85; font-weight:900}
.modal .btns{display:flex; gap:10px; justify-content:flex-end; margin-top:14px}
.modal button{
  padding:10px 14px;
  border-radius:14px;
  border:none;
  font-weight:1200;
  cursor:pointer;
}
.modal .ok{background:var(--good); color:#082010}
.modal .cancel{background:rgba(255,255,255,.08); color:var(--text)}
</style>
</head>

<body>
<div class="app">

  <!-- LEFT -->
  <section class="left">
    <div class="topbar">
      <div class="tabs" id="tabs"></div>
    </div>

    <div class="searchwrap">
      <div class="searchrow">
        <div class="search">
          <span class="icon">ğŸ”</span>
          <input id="q" placeholder="ì „ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ (ì˜ˆ: ê°ì, ã„±ã…ˆ, ã„±ã„±)" autocomplete="off" />
        </div>
        <div class="sort" id="sortBtn" title="ì •ë ¬ì€ ê³ ì • â†’ ë§ì´ì°íŒ(ì‚¬ìš©íšŸìˆ˜) â†’ ì´ë¦„">
          ì •ë ¬: <small>ê³ ì • + ë§ì´ ì°íŒ ìˆœ</small>
        </div>
      </div>

      <div class="cho" id="cho"></div>
    </div>

    <div class="products" id="products"></div>

    <div class="hint">â€» ìƒí’ˆ ê³ ì •: ê¸¸ê²Œ ëˆ„ë¥´ê¸°(ëª¨ë°”ì¼) / ìš°í´ë¦­(PC).  ìƒí’ˆì€ ì¹´ë“œ ì•„ë¬´ë°ë‚˜ ëˆ„ë¥´ë©´ ë‹´ê¹ë‹ˆë‹¤.</div>
  </section>

  <!-- RIGHT -->
  <section class="right">
    <div class="cart" id="cart"></div>

    <div class="summary">
      <div class="row">
        <div>
          <div class="label">ì´í•©ê³„</div>
          <div class="val" id="sum">0ì›</div>
        </div>
        <div style="text-align:right">
          <div class="label">ì´ìˆ˜ëŸ‰</div>
          <div class="smallval" id="qty">0</div>
        </div>
      </div>

      <!-- âœ… í•œ ì¤„: ë°›ì€ëˆ ì™¼ìª½ / ê±°ìŠ¤ë¦„ëˆ ì˜¤ë¥¸ìª½ -->
      <div class="payline">
        <div class="block leftAlign">
          <div class="label">ë°›ì€ëˆ</div>
          <div class="val" id="received">0ì›</div>
        </div>
        <div class="divider"></div>
        <div class="block rightAlign">
          <div class="label">ê±°ìŠ¤ë¦„ëˆ</div>
          <div class="val" id="change">0ì›</div>
        </div>
      </div>
    </div>

    <div class="money">
      <button data-add="500">500</button>
      <button data-add="1000">1ì²œ</button>
      <button data-add="5000">5ì²œ</button>
      <button data-add="10000">1ë§Œ</button>
      <button data-add="50000">5ë§Œ</button>
      <button class="reset" id="reset">ì´ˆê¸°í™”</button>
    </div>

    <button class="pay" id="pay">ê²°ì œì™„ë£Œ</button>
  </section>
</div>

<!-- MODAL -->
<div class="overlay" id="overlay">
  <div class="modal">
    <h3>ê²°ì œ ì™„ë£Œ</h3>
    <p id="modalText">ì •ë§ ê²°ì œì™„ë£Œ ì²˜ë¦¬í• ê¹Œìš”?</p>
    <div class="btns">
      <button class="cancel" id="cancelBtn">ì·¨ì†Œ</button>
      <button class="ok" id="okBtn">í™•ì¸</button>
    </div>
  </div>
</div>

<script>
/* =========================
   0) ë°ì´í„°
   ========================= */
const CATS = ["ê³¼ì¼","ì•¼ì±„","ë´‰ì±„ì†Œ","ìƒì„ ","ê¸°íƒ€"];

// âœ… idë§Œ ìœ ë‹ˆí¬ë©´ ì ˆëŒ€ ì•ˆ ê¼¬ì„ (í† ë§ˆí† â†’ë°”ë‚˜ë‚˜ ë°©ì§€ì˜ í•µì‹¬)
const PRODUCTS = [
  {id:"apple_3",     cat:"ê³¼ì¼",  name:"ì‚¬ê³¼",        price:3000},
  {id:"tomato",      cat:"ê³¼ì¼",  name:"í† ë§ˆí† ",      price:10000},
  {id:"banana",      cat:"ê³¼ì¼",  name:"ë°”ë‚˜ë‚˜",      price:2500},
  {id:"tangerine",   cat:"ê³¼ì¼",  name:"ê·¤",          price:3000},
  {id:"kiwi",        cat:"ê³¼ì¼",  name:"í‚¤ìœ„",        price:10000},
  {id:"straw1",      cat:"ê³¼ì¼",  name:"ë”¸ê¸°/1íŒ©",    price:8000},
  {id:"straw2",      cat:"ê³¼ì¼",  name:"ë”¸ê¸°/2íŒ©",    price:15000},
  {id:"persim3",     cat:"ê³¼ì¼",  name:"ë‹¨ê°/3ê°œ",    price:5000},
  {id:"persim7",     cat:"ê³¼ì¼",  name:"ë‹¨ê°/7ê°œ",    price:10000},

  {id:"onion",       cat:"ì•¼ì±„",  name:"ì–‘íŒŒ",        price:3000},
  {id:"potato",      cat:"ì•¼ì±„",  name:"ê°ì",        price:3000},
  {id:"carrot",      cat:"ì•¼ì±„",  name:"ë‹¹ê·¼",        price:3000},

  {id:"bag_green",   cat:"ë´‰ì±„ì†Œ",name:"ë´‰ì§€ì±„ì†Œ",    price:2000},

  {id:"fish1",       cat:"ìƒì„ ",  name:"ê³ ë“±ì–´",      price:6000},

  {id:"etc1",        cat:"ê¸°íƒ€",  name:"ê³„ë€",        price:6000},
];

/* =========================
   1) ìƒíƒœ ì €ì¥(ê³ ì •/ì‚¬ìš©íšŸìˆ˜/ë§ˆì§€ë§‰ ì¹´í…Œê³ ë¦¬)
   ========================= */
const LS_KEY = "umgane_pos_state_v1";
const state = loadState();

function loadState(){
  try{
    const s = JSON.parse(localStorage.getItem(LS_KEY) || "{}");
    return {
      pinned: s.pinned || {},
      used:   s.used   || {},
      lastCat: s.lastCat || "ê³¼ì¼"
    };
  }catch(e){
    return {pinned:{}, used:{}, lastCat:"ê³¼ì¼"};
  }
}
function saveState(){
  localStorage.setItem(LS_KEY, JSON.stringify(state));
}

/* =========================
   2) ê¸°ë³¸ ìƒíƒœ
   ========================= */
const productMap = Object.fromEntries(PRODUCTS.map(p=>[p.id,p]));
let activeCat = state.lastCat;
let q = "";
let received = 0;
let locked = false;
const cart = {}; // {id: qty}

/* =========================
   3) ì´ˆì„± ê²€ìƒ‰
   ========================= */
const CHO = ["ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……","ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
function getChosung(str){
  let out = "";
  for(const ch of str){
    const code = ch.charCodeAt(0);
    if(code >= 0xAC00 && code <= 0xD7A3){
      const idx = Math.floor((code - 0xAC00) / 588);
      out += CHO[idx] || "";
    }else{
      out += ch;
    }
  }
  return out;
}
function matchQuery(p, query){
  if(!query) return true;
  const t = query.trim();
  if(!t) return true;
  const name = p.name.replace(/\s/g,"");
  const nameLower = name.toLowerCase();
  const tLower = t.toLowerCase().replace(/\s/g,"");
  if(nameLower.includes(tLower)) return true;
  const cho = getChosung(name);
  if(cho.includes(tLower)) return true;
  return false;
}

/* =========================
   4) ë Œë”ë§
   ========================= */
const tabsEl = document.getElementById("tabs");
const productsEl = document.getElementById("products");
const cartEl = document.getElementById("cart");

function renderTabs(){
  tabsEl.innerHTML = "";
  CATS.forEach(cat=>{
    const b = document.createElement("button");
    b.className = "tab" + (cat===activeCat ? " active":"");
    b.textContent = cat;
    b.onclick = ()=>{
      activeCat = cat;
      state.lastCat = cat;
      saveState();
      renderAll();
    };
    tabsEl.appendChild(b);
  });
}

function sortedList(list){
  return list.slice().sort((a,b)=>{
    const ap = !!state.pinned[a.id], bp = !!state.pinned[b.id];
    if(ap !== bp) return ap ? -1 : 1;
    const au = state.used[a.id]||0, bu = state.used[b.id]||0;
    if(au !== bu) return bu - au;
    return a.name.localeCompare(b.name,"ko");
  });
}

function currentProducts(){
  const filtered = PRODUCTS.filter(p=>{
    if(q.trim()) return matchQuery(p, q);   // ê²€ìƒ‰ì´ ìˆìœ¼ë©´ ì „ì¹´í…Œê³ ë¦¬
    return p.cat === activeCat;
  });
  return sortedList(filtered);
}

function renderProducts(){
  productsEl.innerHTML = "";
  const list = currentProducts();

  list.forEach(p=>{
    const d = document.createElement("div");
    d.className = "card";
    d.dataset.id = p.id;

    const used = state.used[p.id] || 0;
    const pinned = !!state.pinned[p.id];

    d.innerHTML = `
      <div class="meta">
        <span class="badge">${"ì‚¬ìš© "+used}</span>
        <span class="pin ${pinned ? "on":""}">ğŸ“Œ</span>
      </div>
      <div class="name">${p.name}</div>
      <div class="price">${p.price.toLocaleString()}ì›</div>
    `;

    // ê¸¸ê²Œëˆ„ë¥´ê¸°/ìš°í´ë¦­ìœ¼ë¡œ ê³ ì •ë§Œ (ë‹´ê¸°ëŠ” ë¶€ëª¨ì—ì„œ ì •í™•íˆ ì²˜ë¦¬)
    attachPinHandlers(d, p.id);

    productsEl.appendChild(d);
  });
}

function flash(el){
  el.classList.add("flash");
  setTimeout(()=>el.classList.remove("flash"), 140);
}

function togglePin(id){
  state.pinned[id] = !state.pinned[id];
  saveState();
  renderProducts();
}

function attachPinHandlers(cardEl, id){
  let pressTimer = null;

  cardEl.addEventListener("touchstart", ()=>{
    pressTimer = setTimeout(()=>{
      // ê¸¸ê²Œëˆ„ë¥´ë©´ ê³ ì • í† ê¸€ + ë‹¤ìŒ í´ë¦­(í„°ì¹˜ì—…) ë‹´ê¸° ë°©ì§€
      cardEl.dataset.suppress = "1";
      togglePin(id);
      setTimeout(()=>{ delete cardEl.dataset.suppress; }, 350);
    }, 450);
  }, {passive:true});

  cardEl.addEventListener("touchend", ()=>{
    if(pressTimer) clearTimeout(pressTimer);
    pressTimer = null;
  });

  cardEl.addEventListener("contextmenu", (e)=>{
    e.preventDefault();
    togglePin(id);
  });
}

/* =========================
   5) âœ… ë‹´ê¸°(ì´ë²¤íŠ¸ ìœ„ì„) â€” í† ë§ˆí† â†’ë°”ë‚˜ë‚˜ ë°©ì§€ í•µì‹¬
   ========================= */
productsEl.addEventListener("click", (e)=>{
  const card = e.target.closest(".card");
  if(!card) return;

  // ê¸¸ê²Œëˆ„ë¥´ê¸° í›„ ë‹´ê¸° ë°©ì§€
  if(card.dataset.suppress === "1") return;

  const id = card.dataset.id;
  if(!productMap[id]){
    alert("ìƒí’ˆID ì˜¤ë¥˜: " + id);
    return;
  }

  addToCart(id, 1);
  flash(card);
});

/* =========================
   6) ì¥ë°”êµ¬ë‹ˆ/í•©ê³„
   ========================= */
function addToCart(id, n){
  cart[id] = (cart[id]||0) + n;
  if(cart[id] <= 0) delete cart[id];

  // â€œë§ì´ ì°íŒâ€ ìš© ì‚¬ìš©íšŸìˆ˜ ëˆ„ì (ì¶”ê°€í•  ë•Œë§Œ)
  if(n > 0){
    state.used[id] = (state.used[id]||0) + 1;
    saveState();
  }

  renderCart();
  renderProducts(); // ì‚¬ìš©ìˆ˜/ì •ë ¬ ë°˜ì˜
}

function sumCart(){
  let sum=0, qty=0;
  for(const id in cart){
    const p = productMap[id];
    sum += p.price * cart[id];
    qty += cart[id];
  }
  return {sum, qty};
}

function renderCart(){
  const {sum, qty} = sumCart();
  document.getElementById("sum").textContent = sum.toLocaleString()+"ì›";
  document.getElementById("qty").textContent = qty;
  document.getElementById("received").textContent = received.toLocaleString()+"ì›";
  document.getElementById("change").textContent = Math.max(0, received - sum).toLocaleString()+"ì›";

  cartEl.innerHTML = `
    <div class="carthead">
      <div>ì¥ë°”êµ¬ë‹ˆ <span class="muted">(ìˆ˜ëŸ‰ ì¡°ì ˆ + ì‚­ì œ)</span></div>
      <div class="muted">í•­ëª© ${Object.keys(cart).length}</div>
    </div>
  `;

  Object.keys(cart).forEach(id=>{
    const p = productMap[id];
    const qn = cart[id];

    const item = document.createElement("div");
    item.className = "item";
    item.innerHTML = `
      <div>
        <div class="title">${p.name} <span style="opacity:.7">x${qn}</span></div>
        <div class="sub">${p.price.toLocaleString()}ì› Â· í•© ${(p.price*qn).toLocaleString()}ì›</div>
      </div>
      <div class="controls">
        <button class="ctrl" data-act="minus">-</button>
        <div class="count">${qn}</div>
        <button class="ctrl" data-act="plus">+</button>
        <button class="ctrl del" data-act="del">âœ•</button>
      </div>
    `;

    item.querySelector('[data-act="minus"]').onclick = ()=> addToCart(id, -1);
    item.querySelector('[data-act="plus"]').onclick  = ()=> addToCart(id,  1);
    item.querySelector('[data-act="del"]').onclick   = ()=> { delete cart[id]; renderCart(); };

    cartEl.appendChild(item);
  });
}

/* =========================
   7) ê²°ì œ(í™•ì¸ íŒì—… + ì†Œë¦¬ + 1ì´ˆ ì ê¸ˆ)
   ========================= */
const overlay = document.getElementById("overlay");
const payBtn = document.getElementById("pay");
const okBtn = document.getElementById("okBtn");
const cancelBtn = document.getElementById("cancelBtn");
const modalText = document.getElementById("modalText");

function beep(){
  try{
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type="sine"; o.frequency.value=880;
    g.gain.value=0.06;
    o.connect(g); g.connect(ctx.destination);
    o.start();
    setTimeout(()=>{ o.stop(); ctx.close(); }, 120);
  }catch(e){}
}

payBtn.onclick = ()=>{
  if(locked) return;
  const {sum, qty} = sumCart();
  modalText.textContent = (qty===0)
    ? "ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì—ˆìŠµë‹ˆë‹¤."
    : `ì´ ${sum.toLocaleString()}ì› / ${qty}ê°œ Â· ê²°ì œì™„ë£Œ ì²˜ë¦¬í• ê¹Œìš”?`;

  overlay.classList.add("show");
  beep();
};
cancelBtn.onclick = ()=> overlay.classList.remove("show");

okBtn.onclick = ()=>{
  overlay.classList.remove("show");
  beep();

  locked = true;
  payBtn.classList.add("locked");

  setTimeout(()=>{
    for(const id in cart) delete cart[id];
    received = 0;
    renderCart();

    locked = false;
    payBtn.classList.remove("locked");
  }, 1000);
};

/* =========================
   8) ë°›ì€ëˆ ë²„íŠ¼ / ì´ˆê¸°í™”(ë°›ì€ëˆë§Œ)
   ========================= */
document.querySelectorAll('.money button[data-add]').forEach(b=>{
  b.onclick = ()=>{
    received += Number(b.dataset.add);
    renderCart();
  };
});
document.getElementById("reset").onclick = ()=>{
  received = 0;
  renderCart();
};

/* =========================
   9) ê²€ìƒ‰/ì´ˆì„±í‚¤
   ========================= */
const qEl = document.getElementById("q");
qEl.value = q;
qEl.addEventListener("input", ()=>{
  q = qEl.value;
  renderProducts();
});

const choEl = document.getElementById("cho");
const choKeys = ["ã„±","ã„´","ã„·","ã„¹","ã…","ã…‚","ã……","ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
choEl.innerHTML = "";
choKeys.forEach(k=>{
  const b = document.createElement("button");
  b.textContent = k;
  b.onclick = ()=>{
    qEl.value = (qEl.value + k);
    q = qEl.value;
    renderProducts();
    qEl.focus();
  };
  choEl.appendChild(b);
});
const clear = document.createElement("button");
clear.className="clear";
clear.textContent="X";
clear.onclick=()=>{
  qEl.value="";
  q="";
  renderProducts();
  qEl.focus();
};
choEl.appendChild(clear);

/* =========================
   10) ì‹¤í–‰
   ========================= */
function renderAll(){
  renderTabs();
  renderProducts();
  renderCart();
}
renderAll();
</script>
</body>
</html>
